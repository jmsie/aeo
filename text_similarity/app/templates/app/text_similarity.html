{% extends './base.html' %}
{% load static %}
{% block title %}AI 語意相似度分析{% endblock %}

{% block content %}
    <!-- Header -->
    <div class="header">
        <h1><i class="fas fa-brain"></i> 提問覆蓋雷達</h1>
        <button class="new-session-btn" onclick="createNewSession()">
            <i class="fas fa-plus"></i> 新工作階段
        </button>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
        <h3><i class="fas fa-history"></i> 歷史工作階段</h3>
        <div id="sessionList"></div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="content-container">
            <div class="analysis-card">
                <div class="form-section">
                    <h3><i class="fas fa-file-text"></i> 主要文本</h3>
                    <div class="alert alert-info mt-3" role="alert">
                        <i class="fas fa-info-circle"></i> 提示：RAG 儲存文件時，會先將文件按照語意切碎。因此建議您在此處輸入文本片段即可，並且每個文本片段建議只包含一個主題。<br>
                        <strong><span style='background-color: #fee2e2; color: #dc2626;'>紅色</span></strong> 表示刪除的段落，不會被計算；<strong><span style='background-color: #dcfce7; color: #16a34a;'>綠色</span></strong> 表示新增的段落，會被計算。
                    </div>                    
                    <div 
                        class="main-textarea" 
                        id="mainText" 
                        contenteditable="true"
                        placeholder="請輸入您要分析的主要文本內容...最多3000字"
                        oninput="checkTextLength()"
                        style="white-space: pre-wrap; overflow-wrap: break-word;"
                    ></div>
                    <div id="textWarning" class="text-warning" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i> 文本超過 1000 字限制，請縮短內容。
                    </div>
                    <button class="btn btn-secondary mt-2" onclick="generateQueries()">
                        <i class="fas fa-magic"></i> 產生用戶提問
                    </button>
                </div>

                <div class="form-section">
                    <h3><i class="fas fa-search"></i> 用戶提問</h3>
                    <div class="query-grid">
                        {% for i in "12345" %}
                        <div class="query-item">
                            <span class="query-label">提問 {{ i }}</span>
                            <input type="text" class="query-input" id="input{{ i }}" placeholder="請輸入搜尋語句...">
                            <div class="score-badge" id="score{{ i }}">-</div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <button class="analyze-btn" onclick="getSimilarityScores()">
                    <i class="fas fa-chart-line"></i> 開始分析相似度
                </button>

                <div id="suggestionBox" class="alert alert-warning mt-3" style="display: none;">
                    <i class="fas fa-lightbulb"></i> 提示：分數低於 60% 表示"用戶提問"與"主文本"的相關性較低。請嘗試修改"文本"，使其更貼近用戶搜尋意圖，以提高被收錄機率。
                </div>
            </div>

            <div class="info-card">
                <h4><i class="fas fa-info-circle"></i> 工具說明</h4>
                <ul>
                    <li>本工具可用於計算多個搜尋語句與主文本之間的語意相似度</li>
                    <li>分數以百分比顯示，分數越高表示語句與文本越相似</li>
                    <li>分數低於 60% 顯示紅色，60-80% 顯示黃色，高於 80% 顯示綠色</li>
                    <li>基於 OpenAI 語意嵌入技術，適合文本比對、搜尋優化等應用</li>
                    <li>可以幫助 AI SEO 文字工作者分析用戶問題和文案的相關性</li>
                </ul>
                <div style="margin-top: 16px; font-size: 14px; opacity: 0.8;">
                    <i class="fas fa-lightbulb"></i> 
                    快速檢查多個搜尋語句與主文案的語意相似度，優化你的內容策略，提升搜尋排名與用戶體驗。
                </div>
            </div>
        </div>
    </div>
    
{% endblock %}


{% block extra_js %}
    <script src="{% static 'js/text_similarity.js' %}"></script>
{% endblock %}
